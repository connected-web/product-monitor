<script type="text/javascript">
var Component = (function() {

  var Class = function() { }

  Class.create = function(elementName) {

    var ComponentClass = function(element) {
      this.element = element;
      this.template = document.getElementById(this.templateName);
      this.content = element.innerHTML;

      this.copyAttributes();
      this.init();
      this.refresh();
    }

    ComponentClass.prototype.elementName = elementName;
    ComponentClass.prototype.templateName = elementName + '-template';

    ComponentClass.prototype.copyAttributes = function() {
      var element = this.element;
      for(var i=0; i < element.attributes.length; i++) {
        var attribute = element.attributes[i];
        this[attribute.name] = attribute.value;
      }
    }

    ComponentClass.prototype.init = function() {
      // roll your own
      this.render();
    }

    ComponentClass.prototype.refreshTimeSeconds = 0;
    ComponentClass.refreshTime = function(seconds) {
      ComponentClass.prototype.refreshTimeSeconds = seconds;
      return ComponentClass;
    }

    ComponentClass.prototype.render = function() {
        var expandedTemplate = this.template.innerHTML;
        for(var property in this) {
          var matcher = new RegExp("{{x}}".replace("x", property), "g");
          var value = this[property] || '';
          expandedTemplate = expandedTemplate.replace(matcher, value);
        }

        this.element.innerHTML = expandedTemplate;
    }

    ComponentClass.prototype.refresh = function() {
      // Prevent timeout leaks
      if(this.refreshTimeoutId) {
        clearTimeout(this.refreshTimeoutId);
      }

      // loop
      var self = this;
      if(this.refreshTimeSeconds) {
        this.refreshTimeoutId = setTimeout(function() {
          self.refresh();
        }, this.refreshTimeSeconds * 1000 + Math.random() * 500);
      }

      // Re-initialise the component
      this.init();
    }

    function setup() {
      var elements = document.getElementsByTagName(elementName);
      for(var i=0; i<elements.length; i++) {
        var element = elements[i];
        new ComponentClass(element);
      }
    }

    $(window).load(setup);

    return ComponentClass;
  }

  return Class;
})();
</script>
