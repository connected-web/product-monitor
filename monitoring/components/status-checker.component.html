<script type="template" id="status-checker-template">
  <div class="row">
    <div class="col-md-4">
      <div class="alert alert-default" role="alert">
        <span class="glyphicon glyphicon-off"></span>
          <name>${name}</name>
          (<status>${statusCode}</status>)
      </div>
    </div>
    <div class="col-md-8">
      <div class="alert alert-${alertType}" role="alert">
        <message>${message}</message>
      </div>
    </div>
  </div>
</script>

<script type="text/javascript">
(function() {

  var StatusChecker = Component.create("status-checker");

  StatusChecker.prototype.init = function() {
    var element = this.element;

    this.urlName = element.innerHTML;
    this.urlToCheck = element.getAttribute('data-url');

    this.checkStatusCodeOf(this.urlToCheck);
  }

  StatusChecker.prototype.checkStatusCodeOf = function(urlToCheck) {
    var self = this;
    self.render(0, 'Checking url: ' + urlToCheck);

    $.ajax({
      url: "/api/statusOf/?url=" + urlToCheck,
      dataType: "jsonp",
      success: function(data, textStatus) {
        if(data.statusCode) {
          self.render(data.statusCode, "Checked url: " + urlToCheck);
        }
        else {
          self.render(500, "/api/statusOf endpoint returned unexpected data.");
        }
      }
    }).fail(function() {
      self.render(500, "/api/statusOf endpoint failed to return data.");
    });
  }

  StatusChecker.prototype.render = function(statusCode, message) {
    var statusCode = statusCode || 0;
    var message = message || '';

    var alertType = ({
      "0": 'info',
      "200": 'success'
    })[statusCode] || 'danger';

    var result = this.template.innerHTML;
    result = result.replace('${name}', this.urlName);
    result = result.replace('${url}', this.urlToCheck);
    result = result.replace(/\${alertType}/g, alertType);
    result = result.replace('${statusCode}', statusCode);
    result = result.replace('${message}', message);

    console.log("Alert type: " + alertType)

    this.element.innerHTML = result;
  }
})();
</script>
