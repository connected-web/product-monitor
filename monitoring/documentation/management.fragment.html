<h1>Management Console</h1>

<p>The place to interact with the server...</p>

<h3>Package Status</h3>
<package-status data-source-url="/api/npmStatus"></package-status>

<h3>Server Console Log</h3>

<console-log id="server-console-log" line-limit="50" data-source-template="/api/serverLog/{{line-limit}}/{{order}}" refresh-time="10">
  <set-property property="line-limit" value="10" target="server-console-log" button-type="info">10 lines</set-property>
  <set-property property="line-limit" value="50" target="server-console-log" button-type="info">50 lines</set-property>
  <set-property property="line-limit" value="100" target="server-console-log" button-type="info">100 lines</set-property>
  <set-property property="order" value="ascending" target="server-console-log" button-type="warning">Oldest First</set-property>
  <set-property property="order" value="descending" target="server-console-log" button-type="warning">Newest First</set-property>
</console-log>

<!-- Console Log Component -->
<template for="console-log">
  {{content}} {{#each lines}}
  <line>
    <timestamp>[{{date}}]</timestamp>
    <span>{{line}}</span>
  </line>
  {{/each}}
</template>

<style for="console-log">
  console-log {
    margin-top: -3px;
    display: block;
    background: #111;
    padding: 4px;
    border-radius: 3px;
    border: 1px solid #555;
  }

  @media (max-width: 992px) {
    console-log > line > timestamp {
      display: block;
    }
  }

  console-log > line {
    font-family: monospace;
    font-size: 90%;
    display: block;
    margin: 3px 4px;
    padding: 0 0 2px 0;
    border-bottom: 1px solid #222;
  }

  console-log > line > timestamp {
    color: #FD8;
  }

  console-log > line > span {
    white-space: pre;
    color: #CFA;
  }
</style>

<!-- Set Property Component -->
<template for="set-property">
  <button class="btn btn-{{button-type}}">{{content}}</button>
</template>

<script for="set-property" type="text/javascript">
  Component.queuedItems.push(function() {
    var SetPropertyComponent = Component.configure('set-property');

    SetPropertyComponent.on('renderComplete', function(instance) {
      $(instance.element).click(function() {
        // Find and change the property on the target
        var target = $('#' + instance.target);
        target.attr(instance.property, instance.value);
        console.log('Changing', instance.property, 'to', instance.value, 'on', instance.target);

        // Refresh the element if its a web component
        var webComponentId = target.attr("webcomponentid");
        if (webComponentId) {
          var componentClass = Component.configure(target[0].tagName);
          var component = componentClass.registeredInstances[webComponentId];
          component.refresh();
        };
      });
    });

    SetPropertyComponent.apply(function(instance) {
      instance.render();
    });
  });
</script>

<!-- NPM Package Status Component -->
<template for="package-status">
  <div class="row header">
    <div title="Package Name" class="col-md-6">Package Name</div>
    <div title="Current" class="col-md-2">Current</div>
    <div title="Wanted" class="col-md-2">Wanted</div>
    <div title="Latest" class="col-md-2">Latest</div>
  </div>
  {{#each output}}
  <div class="row">
    <div title="Package Name" class="col-md-6">{{@key}}</div>
    <div title="Current" class="col-md-2">{{current}}</div>
    <div title="Wanted" class="col-md-2">{{wanted}}</div>
    <div title="Latest" class="col-md-2">{{latest}}</div>
  </div>
  {{/each}}
  {{content}}
</template>

<style for="package-status">
package-status, package-status > div {
  display: block;
}
package-status > div.header {
  font-weight: bold;
}
package-status > div > * {
  display: inline-block;
  min-width: 120px;
}
</style>
