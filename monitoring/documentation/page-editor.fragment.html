<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.5.0/codemirror.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.5.0/codemirror.min.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.5.0/mode/xml/xml.min.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.5.0/mode/css/css.min.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.5.0/mode/javascript/javascript.min.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.5.0/mode/htmlmixed/htmlmixed.min.js" type="text/javascript"></script>

<h1>Page Editor</h1>

<div class="buttons">
    <button class="btn btn-warning" id="save">
        <icon>save</icon>
        <span>Save</span>
    </button>

    <button class="btn btn-info" id="preview">
        <icon>eye-open</icon>
        <span>Preview</span>
    </button>

    <button class="btn btn-info hidden" id="edit">
        <icon>pencil</icon>
        <span>Edit</span>
    </button>

    <button class="btn btn-danger" id="cancel">
        <icon>remove</icon>
        <span>Cancel</span>
    </button>
</div>

<div id="page-editor-container"></div>

<style for="page-editor-container">
    #page-editor-container {
        border: 1px solid #eee;
        border-radius: 3px;
        padding: 5px;
        height: 100%;
    }

    .buttons {
        border: 1px solid #eee;
        border-radius: 3px;
        padding: 5px;
        text-align: right;
        margin-bottom: 3px;
    }
</style>

<script type="text/javascript">
    $(function() {
        var contentPath = decodeURIComponent(getUrlParameter('page'));
        var container = document.getElementById('page-editor-container');

        var contents = 'Loading page contents...\n\n\n\n';

        var editPageMirror = CodeMirror(container, {
            value: contents,
            lineNumbers: true,
            mode: "htmlmixed"
        });

        $('button#cancel').click(function() {
          alert('You clicked cancel!');
          // TODO: Check for unsaved changes and warn the user
          window.location = '/content/' + contentPath;
        });

        Component.scanForComponents(container);
    });

    function getUrlParameter(sParam) {
        var sPageURL = window.location.search.substring(1);
        var sURLVariables = sPageURL.split('&');
        for (var i = 0; i < sURLVariables.length; i++) {
            var sParameterName = sURLVariables[i].split('=');
            if (sParameterName[0] == sParam) {
                return sParameterName[1];
            }
        }
    }
</script>
