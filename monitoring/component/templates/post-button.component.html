<!--
<post-button post-url="/api/postMirror" result-target="output">I can post things?</post-button>
<div id="output"></div>
-->

<template for="post-button">
    <button class="btn btn-info">{{content}}</button>
    <pre>{{dataSourcePostResponse}}</pre>
</template>

<script for="post-button">
    $(function() {
        var PostButtonComponent = Component.configure('post-button');

        function copyElementProperties(elem, target) {
            for (var i = 0; i < elem.attributes.length; i++) {
                var attrib = elem.attributes[i];
                if (attrib.specified) {
                    target[attrib.name] = attrib.value;
                }
            }
        }

        function createAttributePropertiesOn(elem, properties) {
            for (var property in properties) {
                elem.setAttribute(property, JSON.stringify(properties[property]));
            }
        }

        PostButtonComponent.on('renderComplete', function(instance) {
            $(instance.element).click(function() {
                $(instance.element).attr('disabled', 'disabled').unbind("click");
                var postUrl = instance['post-url'] || false;
                var resultTarget = instance['result-target'] || false;

                console.log("Post button knows about: ", postUrl);
                if (postUrl) {
                    var postData = {};
                    copyElementProperties(instance.element, postData);
                    $.post(postUrl, postData, function(data) {
                        for (var property in data) {
                            instance[property] = data[property];
                        }

                        if (resultTarget) {
                            var targetElement = document.getElementById(resultTarget);
                            if (targetElement) {
                                createAttributePropertiesOn(targetElement, data);
                                Component.scanForComponents(targetElement.parentElement);
                            }
                            else {
                              console.log("Specified result-target could not be found in DOM: ", resultTarget);
                            }
                        }
                        else {
                          console.log("No result-target specified to assign data to.");
                        }
                    });
                }
            });
        });

        PostButtonComponent.apply(function(instance) {
            instance.render();
        });
    });
</script>

<style for="post-button">
    post-button {
        display: inline-block;
    }
</style>
