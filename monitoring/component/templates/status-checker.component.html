<template for="status-checker" data-source-template="/api/statusOf/?url={{data-url}}{{#if data-contains}}&contains={{data-contains}}{{/if}}" refresh-time="25">
  <div class="alert alert-{{alertType}}" role="alert">
    <div class="row">
      <div class="col-md-6">
        <a href="{{data-url}}" target="_statusButtonLink" title="{{urlProvided}}" class="status-checker">
          <button type="button" class="btn btn-{{alertType}} status-checker">
            <span class="glyphicon glyphicon-flag"></span>
          </button>
        </a>
        <span class="status-description">{{content}} (<status>{{statusCode}}</status>)</span>
      </div>
      <div class="col-md-6">
        <p><b>{{interpretation}}</b> : {{data-url}}</p>
        {{#if message}}{{message}}{{/if}}
      </div>
    </div>
  </div>
</template>

<style for="status-checker">
span.status-description {
  font-size: 150%; font-weight: bold;
  vertical-align: middle;
}
button.status-checker {
  margin-right: 5px;
}
a.status-checker { text-decoration: none; }
</style>

<script type="text/javascript">
$(function() {

  var StatusChecker = Component.configure("status-checker");

  StatusChecker.prototype.selectMessage = function(statusCode) {
    return ({
      "0": 'Checking server',
      "200": 'URL Seems OK',
      "404": "File not found",
      "500": "Server responded with an error: " + this.dataSourceData,
      "503": "Server is unavailable"
    })[statusCode] || this.dataSourceStatus;
  }

  StatusChecker.prototype.selectAlertType = function(statusCode) {
    var severity = Math.round(statusCode / 100) * 100;
    return ({
      "0": 'info',
      "100": 'primary',
      "200": 'success',
      "300": 'info',
      "400": 'danger',
      "500": 'warning'
    })[severity] || 'danger';
  }

  StatusChecker.on('preRenderStep', function() {
    this.statusCode = (this.dataSourceError === false) ? this.statusCode : 503;
    this.alertType = this.selectAlertType(this.statusCode);
    this.interpretation = this.selectMessage(this.statusCode);
  });

});
</script>
